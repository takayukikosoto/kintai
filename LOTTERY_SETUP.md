# 🎰 抽選機能セットアップ手順

## 初回セットアップ

### 1. 開発サーバー起動
```bash
npm run dev
```

### 2. 管理者アカウントでログイン
- `kosoto@t-kst.com` または `kanri@t-kst.com`

### 3. 抽選設定ページにアクセス
- ナビゲーションから「🎰 抽選設定」をクリック

### 4. 景品を登録

以下の景品を登録してください：

#### SSR景品
- **名前**: ゲームソフト
- **絵文字**: 🎮
- **確率**: 0.02%
- **レアリティ**: SSR（超激レア）

#### 通常景品
1. **ウィダーインゼリー**
   - 絵文字: 🥤
   - 確率: 10%
   - レアリティ: 通常

2. **ミネラルウォーター**
   - 絵文字: 💧
   - 確率: 10%
   - レアリティ: 通常

3. **チュッパチャプス**
   - 絵文字: 🍬
   - 確率: 10%
   - レアリティ: 通常

4. **駄菓子**
   - 絵文字: 🍘
   - 確率: 20%
   - レアリティ: 通常

5. **ハズレ（ティッシュ1個）**
   - 絵文字: 🧻
   - 確率: 49.98%
   - レアリティ: 通常

**合計確率**: 100.00%

---

## 抽選の仕組み

### 抽選タイミング
- **1日2回**: 
  - ① 午前の出勤時（5:00-11:59）
  - ② 昼食後の出勤時（12:00-23:59）

### 抽選方法
1. 連続スキャナーページでQRコードをスキャン
2. 出勤時に自動的に抽選実行
3. ガチャアニメーション表示（約3秒）
4. 当選した景品を表示

### 重複防止
- 同じ日・同じ時間帯での抽選は1回のみ
- 既に抽選済みの場合は実行されない

---

## テスト手順

### 1. 景品設定の確認
- 抽選設定ページで合計確率が100%になっているか確認

### 2. 抽選テスト
1. マイページでQRコードを表示
2. 連続スキャナーページを開く
3. スキャン開始
4. QRコードをカメラにかざす
5. 出勤処理後、抽選アニメーションが表示されることを確認

### 3. 2回目の抽選テスト（昼食後）
- システム時刻を12:00以降に変更
- または実際に12:00以降に再度テスト

---

## トラブルシューティング

### 抽選が実行されない
- Firestoreの`prizes`コレクションに景品が登録されているか確認
- 景品の`enabled`が`true`になっているか確認
- 既に今日抽選済みの可能性（`lotteryResults`コレクションを確認）

### エラーが出る
- ブラウザのコンソールでエラーメッセージを確認
- Firestoreのセキュリティルールを確認

### 確率がおかしい
- 抽選設定ページで合計確率を確認
- 各景品の確率が正しく設定されているか確認

---

## Firestoreコレクション

### prizes
```json
{
  "name": "ウィダーインゼリー",
  "emoji": "🥤",
  "rarity": "normal",
  "probability": 10,
  "enabled": true,
  "order": 0,
  "createdAt": "2025-10-07T...",
  "updatedAt": "2025-10-07T..."
}
```

### lotteryResults
```json
{
  "userId": "xxx",
  "date": "2025-10-07",
  "slot": "morning",
  "prizeId": "prize_abc123",
  "prizeName": "ウィダーインゼリー",
  "prizeEmoji": "🥤",
  "rarity": "normal",
  "timestamp": "2025-10-07T09:00:00.000Z"
}
```

---

## 今後の拡張案

- 抽選履歴の表示（ユーザーページ）
- 連勤ボーナス（3日連続出勤で確率UP）
- 月間ランキング（当選回数）
- 管理者向け抽選統計ダッシュボード
